<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<%- include('../partials/heading5.hbs') %>


<body>

      <!------------------------------------------------------------------------------>
      <h1>Upload files to database</h1>

      <form id="myform"method="POST"enctype="multipart/form-data" >

    <!-- <img src="" id="newimage" style="width:200px;height:200px;"><br>
    <input type="file" id="photo" /><br> -->
    <!-- <label ></label><br> -->

    <div class="form-group">
      <label for="exampleFormControlTextarea1">Enter details about of exam</label>
      <textarea class="form-control"rows="3" id="infodata"></textarea>
    </div>

    <div class="form-group">
    <label >Enter details about exam</label><br>
    <input type="text" id="details3"><br>
    </div>

    <div class="form-group">
      <label >Enter preview image address</label><br>
      <input type="text" id="previewimg"><br>
      </div>

    <div class="form-group">
      <label >Enter Date</label><br>
      <input type="text" id="content4"><br>
      </div>

    <div class="form-group">
      <label for="exampleFormControlSelect1"> select the topic of your content</label>
      <select class="form-control" id="content1" name="content" style="width:200px;">
        <option value="Government Exams">Government Exams</option>
        <option value="Bank Exams">Bank Exams</option>
        <option value="Management Exams">Management Exams</option>
        <option value="Engineering Entrance Exams">Engineering Entrance Exams</option>
        <option value="Other Exams">Other Exams</option>      
      </select>
    </div>     

    <div class="form-group">
      <label for="exampleFormControlSelect1"> select the status</label>
      <select class="form-control" id="content2" name="content" style="width:200px;">
        <option value="publicfile">publicfile</option>
         </select>
    </div>    
      <select class="form-control" id="content3" name="content" style="width:200px;">
        <option value="Notification">Notification</option>
        <option value="StudyMaterial">Study Material</option>
        <option value="SolvedPapers">Solved Papers</option>
         </select>
    </div> <br>
    
    
    <button type="submit" class="btn btn-primary">Submit data</button><br><br>

    <div><br>
      Upload Preview image <input type="file" id="photo1" />
  
      <button type="button" onclick="uploadPreview()">Upload Preview</button>
  
    </div><br>
  
    <div>
      Upload Study Material <input type="file" id="photo" />
  
      <button type="button" onclick="uploadFile()">Upload File</button>
  
    </div><br>


</body>

<script src="https://www.gstatic.com/firebasejs/7.7.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.7.0/firebase-storage.js"></script>


    <script>

const firebaseConfig = {
    apiKey: "AIzaSyAZ9x_QbhCfY9aEsqxEiYhWtfIRNGl_qeo",
    authDomain: "mynewproject-ae49a.firebaseapp.com",
    projectId: "mynewproject-ae49a",
    storageBucket: "mynewproject-ae49a.appspot.com",
    messagingSenderId: "939005557600",
    appId: "1:939005557600:web:ee766070db4bd2dadfbc05",
    measurementId: "G-YFKTT151SN"
  };

firebase.initializeApp(firebaseConfig);




$("#myform").on("submit",function(e){  
  e.preventDefault()
       var formData = {
      details:$("#infodata").val(),
     examname:$("#details3").val(),
     examtype:$("#content1").val(),
     status:$("#content2").val(),
     previewimg:$("#previewimg").val(),
    MaterialType:$("#content3").val(),
    currentDate:$("#content4").val(),
     uploadPreview:imagePath1,
     myfile:imagePath,
    
   };

        $.ajax({
            url:"/uploadcontent",
            method:"POST",
            data:formData,
            success:function(response){
            
                alert(response.message)
              imagePath=""
             
             
            }
        })
    
    })

//---------------------------------------upload-----------------------------------------------

async function uploadFile() {
        const ref = firebase.storage().ref();
        const file = document.querySelector("#photo").files[0];
        const name = +new Date() + "-" + file.name;
        const metadata = {
          contentType: file.type
        };
        try {
          await ref.child(name).put(file, metadata).then(snapshot => snapshot.ref.getDownloadURL())
            .then(url => {
              newurl = url
              callback(url)
            })
        }
        catch (err) {
          console.log(err)
        }

        function callback(url) {
          console.log(url)
          newcallback(url)
        }
      }
      var imagePath = ""
      function newcallback(url) {
        let newurl = url;
        var formData = {
          uploadimg: newurl,
        };
        $.ajax({
          url: "/do-uploadprofileimage3",
          method: "POST",
          data: formData,
          success: function (response) {
            alert(response)
            imagePath = response;
console.log(imagePath)
          }
        
        })
      }

      async function uploadPreview() {
        const ref = firebase.storage().ref();
        const file = document.querySelector("#photo1").files[0];
        const name = +new Date() + "-" + file.name;
        const metadata = {
          contentType: file.type
        };
        try {
          await ref.child(name).put(file, metadata).then(snapshot => snapshot.ref.getDownloadURL())
            .then(url => {
              newurl = url
              callback1(url)
            })
        }
        catch (err) {
          console.log(err)
        }

        function callback1(url) {
          console.log(url)
          newcallback1(url)
        }
      }
      var imagePath1 = ""
      function newcallback1(url) {
        let newurl = url;
        var formData = {
          uploadimg: newurl,
        };
        $.ajax({
          url: "/do-uploadprofileimage3",
          method: "POST",
          data: formData,
          success: function (response) {
            alert(response.message)
            imagePath1 = response;
          }
        })
      }
     







//-----------------------------------------------------------------------------------------

//---------------------------------file reading----------------------------------------------------




//     async function uploadImage() {
     
//       const ref = firebase.storage().ref();
//       const file = document.querySelector("#photo").files[0];
//       const name = +new Date() + "-" + file.name;
//       const metadata = {
//         contentType: file.type
//       };
//          try{
//       await ref.child(name).put(file, metadata).then(snapshot => snapshot.ref.getDownloadURL())
//         .then(url => {
//             newurl=url

//             callback(url)
          
         
//         })
//     }
//     catch(err){
//         console.log(err)
//     }
//    function callback(url){
//        console.log(url)
//        newcallback(url)
//    }
//     }
    
// function newcallback(url){
  
//    $.ajax({
//             url:"/uploadcontent",
//             method:"POST",
//             data:formData,
//             success:function(response){          
//                 alert(response.message)            
//             }
//         })


// }
    


//--------------------------------------------------------------------------------------------







    </script>

</html>