<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
    integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.min.js"
    integrity="sha384-Atwg2Pkwv9vp0ygtn1JAojH0nYbwNJLPhwyoVbhoPwBhjQPR5VtM2+xf0Uwh9KtT"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4"
    crossorigin="anonymous"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
</head>

<body>

  <% quiz.quizquestions.forEach(function(elem,index){ %>


    <div class="border " style="width:700px;margin-top: 20px;">
      <form onsubmit="updatequestion(this)" class="bg-light">
        <!-- <div class="form-group">
            <label for="exampleInputEmail1">Enter the quizname</label>
            <input type="number" class="form-control" aria-describedby="emailHelp" placeholder="Question Number"
              name="numb" id="numb" value=''>
          </div> -->

        <div class="form-group">
          <label for="exampleInputEmail1">Enter the sectionName</label>
          <input type="number" class="form-control" aria-describedby="emailHelp" placeholder="Question Number"
            name="section" id="section" value='<%=elem.section%>'>
        </div>

        <div class="form-group">
          <label for="exampleInputEmail1">Enter the number of questions</label>
          <input type="number" class="form-control" aria-describedby="emailHelp" placeholder="Question Number"
            name="qsection" id="qsection" value='<%=elem.qsection %>'>
        </div>

        <div class="form-group">
          <label for="exampleInputEmail1">Enter the question number</label>
          <input type="number" class="form-control" aria-describedby="emailHelp" placeholder="Question Number"
            name="numb" id="numb" value='<%=elem.numb %>'>
        </div>
        <div class="form-group">
          <label for="exampleInputEmail1">Enter the question </label>
          <input type="text" class="form-control" aria-describedby="emailHelp" placeholder="Enter the question"
            name="question" id="question" value='<%=elem.question%>'>
        </div>

        <div class="form-group">
          <label for="exampleInputEmail1">Enter the queimg </label>
          <input type="text" class="form-control" aria-describedby="emailHelp" placeholder="Enter the question"
            name="queimg" id="queimg<%=index%>" value='<%=elem.queimg%>'>
        </div>



        <div class="form-group">
          <label for="exampleInputEmail1">Enter the integer answer 1 to 10 </label>
          <input type="number" class="form-control" aria-describedby="emailHelp" placeholder="Enter the integer"
            name="integerans" id="integerans" value='<%=elem.integerans%>'>
        </div>

        <div class="form-group">
          <label for="exampleInputEmail1">Enter the passage to be read </label>
          <textarea class="form-control" rows="5" name="passage" id="passage" value='<%=elem.passage %>'></textarea>
        </div>

        <div class="form-group">
          <label for="exampleInputEmail1">Enter the passageimg </label>
          <input type="text" class="form-control" aria-describedby="emailHelp" placeholder="Enter the question"
            name="passageimg" id="passageimg<%=index %>" value='<%=elem.passageimg%>'>
        </div>

        <div class="form-group">
          <label for="exampleInputEmail1">Enter the answercode1</label>
          <input type="number" class="form-control" aria-describedby="emailHelp" placeholder="Enter Answercode"
            name="answercode1" id="answercode1" value="<%=elem.answercode1 %>">
        </div>

        <div class="form-group">
          <label for="exampleInputEmail1">Enter the answercode2</label>
          <input type="number" class="form-control" aria-describedby="emailHelp" placeholder="Enter Answercode"
            name="answercode2" id="answercode2" value="<%=elem.answercode2 %>">
        </div>

        <div class="form-group">
          <label for="exampleInputEmail1">Enter the answercode3</label>
          <input type="number" class="form-control" aria-describedby="emailHelp" placeholder="Enter Answercode"
            name="answercode3" id="answercode3" value="<%=elem.answercode3 %>">
        </div>

        <div class="form-group">
          <label for="exampleInputEmail1">Enter the Option 1</label>
          <input type="text" class="form-control" aria-describedby="emailHelp" placeholder="Enter Option1"
            name="option1" id="option1" value='<%=elem.option1%>'>
        </div>

        <div class="form-group">
          <label for="exampleInputEmail1">Enter the Option 2</label>
          <input type="text" class="form-control" aria-describedby="emailHelp" placeholder="Enter Option2"
            name="option2" id="option2" value='<%=elem.option2%>'>
        </div>

        <div class="form-group">
          <label for="exampleInputEmail1">Enter the Option 3</label>
          <input type="text" class="form-control" aria-describedby="emailHelp" placeholder="Enter Option3"
            name="option3" id="option3" value='<%=elem.option3%>'>
        </div>

        <div class="form-group">
          <label for="exampleInputEmail1">Enter the Option 4</label>
          <input type="text" class="form-control" aria-describedby="emailHelp" placeholder="Enter Option4"
            name="option4" id="option4" value='<%=elem.option4%>'>
        </div>

        <div class="form-group">
          <label for="exampleFormControlTextarea1">Enter the solution</label>
          <textarea class="form-control" rows="5" name="Mysolutions" id="Mysolutions"
            value='<%elem.solution%>'></textarea>
        </div>

        <div class="form-group">
          <label for="exampleInputEmail1">Enter the solutionimg</label>
          <input type="text" class="form-control" aria-describedby="emailHelp" placeholder="Enter the question"
            name="solutionimg" id="solutionimg<%=index %>" value='<%=elem.solutionimg%>'>
        </div>

        <div class="form-group">
          <label for="exampleInputEmail1">Enter the myfile</label>
          <input type="text" class="form-control" aria-describedby="emailHelp" placeholder="Enter the question"
            name="myfile" id="myfile<%=index %>" value='<%=elem.myfile%>'>
        </div>
        <div>


          <div class="form-group">
            <label for="exampleInputEmail1">Enter the option1</label>
            <input type="text" class="form-control" aria-describedby="emailHelp" placeholder="Enter the question"
              name="optionImg1" id="option<%=index %>" value='<%=elem.optionImg1%>'>
          </div>
          <div>

            <div class="form-group">
              <label for="exampleInputEmail1">Enter the option2</label>
              <input type="text" class="form-control" aria-describedby="emailHelp" placeholder="Enter the question"
                name="optionImg2" id="option2<%=index %>" value='<%=elem.optionImg2%>'>
            </div>
            <div>
              <br>

              <div class="form-group">
                <label for="exampleInputEmail1">Enter the option3</label>
                <input type="text" class="form-control" aria-describedby="emailHelp" placeholder="Enter the question"
                  name="optionImg3" id="option3<%=index %>" value='<%=elem.optionImg3%>'>
              </div>
              <div>
                <br>

                <div class="form-group">
                  <label for="exampleInputEmail1">Enter the option4img</label>
                  <input type="text" class="form-control" aria-describedby="emailHelp" placeholder="Enter the question"
                    name="optionImg4" id="option4<%=index %>" value='<%=elem.optionImg4%>'>
                </div>
                <div>

                  <select class="form-control" name="type" id="type" value='<%=elem.type%>'>
                    <option value="multichoice">multichoice</option>
                    <option value="integertype">integertype</option>
                    <option value="passage">passage</option>
                    <option value="multi">multipleoptions</option>
                  </select>

                  <div class="form-group">
                    <label for="exampleInputEmail1">Enter the time for the test</label>
                    <input type="number" class="form-control" id="time" aria-describedby="emailHelp"
                      placeholder="Enter totaltime" name="time" value=<%=elem.time %>>
                  </div>

                  <div class="form-group">
                    <label for="exampleInputEmail1">Enter postive marks awarded if any</label>
                    <input type="text" class="form-control" id="pm" aria-describedby="emailHelp"
                      placeholder="Enter beforetime" name="postivemarks" value=<%=elem.postivemarks %>>
                  </div>

                  <div class="form-group">
                    <label for="exampleInputEmail1">Enter negative marks if any</label>
                    <input type="text" class="form-control" id="nm" aria-describedby="emailHelp"
                      placeholder="Enter beforetime" name="negativemarks" value=<%=elem.negativemarks %>>
                  </div>
                  <button type="submit" class="btn btn-primary ">Update the question</button>
                  <div>
                    Upload Question accompanying image <input type="file" id="photo" />
                    <button type="button" name="<%=index %>" onclick="uploadImage(this)">Upload Question accompanying
                      image</button>
                  </div>
                  <div class="form-group">
                    Upload solutions Image <input type="file" id="photo1" />
                    <button type="button" onclick="uploadImage1(index)">Upload Solution image</button>
                  </div>

                  <div class="form-group">
                    Upload passage Image <input type="file" id="photo2" />
                    <button type="button" onclick="uploadImage2(index)">Upload passage image</button>
                  </div>
                  <div>
                    Upload solutions Image <input type="file" id="photo3" />
                    <button type="button" onclick="uploadImage3(index)">Upload Solution image</button>
                  </div>


                  <div>
                    Upload Question option1 image <input type="file" id="photo5" />
                    <button type="button" name="<%=index %>" onclick="uploadImage5(this)">Upload Question option1 image</button>
                  </div>
                  <br>

                  <div>
                    Upload Question option2 image <input type="file" id="photo6" />
                    <button type="button" onclick="uploadImage6(index)">Upload Question option2 image</button>
                  </div>
                  <br>



                  <div>
                    Upload Question option3 image <input type="file" id="photo7" />
                    <button type="button" onclick="uploadImage7(index)">Upload Question option3 image</button>
                  </div>
                  <br>

                  <div>
                    Upload Question option4 image <input type="file" id="photo8" />
                    <button type="button" onclick="uploadImage8(index)">Upload Question option4 image</button>
                  </div>
                  <br>
      </form>










    </div>


    <br>
    <% }) %>
</body>

<script src="https://www.gstatic.com/firebasejs/7.7.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.7.0/firebase-storage.js"></script>
<script>

  //console.log(document.getElementById("option30").value.split("/o")[1].split("?")[0].split("/")[1])

  function updatequestion(data) {

    e.preventDefault()
    alert("ddd")


    var formData = {
      yourquiz: $("#yourquiz").val(),
      no: $("#no").val(),
      section: $("#section").val(),
      passage: $("#passage").val(),
      qno: $("#qno").val(),
      myquestion: $("#myquestion").val(),
      qsection: $("#qsection").val(),
      Mysolutions: $("#Mysolutions").val(),
      myinteger: $("#myinteger").val(),
      answercode1: $("#answercode1").val(),
      answercode2: $("#answercode2").val(),
      answercode3: $("#answercode3").val(),
      myquestion1: $("#myquestion1").val(),
      myquestion2: $("#myquestion2").val(),
      myquestion3: $("#myquestion3").val(),
      myquestion4: $("#myquestion4").val(),
      type: $("#type").val(),
      time: $("#mytime").val(),
      positivemarks: $("#pm").val(),
      negativemarks: $("#nm").val(),
      myquestionimg: imagePath,
      Mysolutionsimg: imagePath1,
      passageimg: imagePath2,
      myfiles: imagePath3,
      optionImg1: imagePath5,
      optionImg2: imagePath6,
      optionImg3: imagePath7,
      optionImg4: imagePath8,



    };


    $.ajax({
      url: "/postmultioptions",
      method: "POST",
      data: formData,
      success: function (response) {

        $("#photo1").val('');
        $("#photo2").val('');
        $("#photo3").val('');
        $("#photo").val('');
        imagePath = ""
        imagePath1 = ""
        // imagePath2 = ""
        imagePath3 = ""
        imagePath5 = ""
        imagePath6 = ""
        imagePath7 = ""
        imagePath8 = ""
        alert(response.message)

      }
    })
    return false;

  }


  //-----------------------------Using firebase to store images and questions----------------------///


  const firebaseConfig = {
    apiKey: "AIzaSyAZ9x_QbhCfY9aEsqxEiYhWtfIRNGl_qeo",
    authDomain: "mynewproject-ae49a.firebaseapp.com",
    projectId: "mynewproject-ae49a",
    storageBucket: "mynewproject-ae49a.appspot.com",
    messagingSenderId: "939005557600",
    appId: "1:939005557600:web:ee766070db4bd2dadfbc05",
    measurementId: "G-YFKTT151SN"
  };

  firebase.initializeApp(firebaseConfig);


  async function uploadImage(data) {
    const ref = firebase.storage().ref();
    const file = document.querySelector("#photo").files[0];
    const name = +new Date() + "-" + file.name;
    const metadata = {
      contentType: file.type
    };
    let url = "data"
    let oldimg = document.getElementById("myfile" + data.name).value.split("/o")[1].split("?")[0].split("/")[1]
    try {
      ref.child(oldimg).delete()
      console.log("file is deleted")
      RetrieveAll()
    }
    catch (err) {
      console.log(err)
    }



    // try {
    //   await ref.child(name).put(file, metadata).then(snapshot => snapshot.ref.getDownloadURL())
    //     .then(url => {
    //       newurl = url
    //      callback(url,data)
    //     })
    // }
    // catch (err) {
    //   console.log(err)
    // }
    function callback(url, data) {
      console.log(url)
      newcallback(url, data)
    }
  }
  function newcallback(url, data) {
    let newurl = url;

    console.log(data.name)

    console.log("link")


    console.log(url)
    // var formData = {
    //   uploadimg: newurl,
    // };
    // $.ajax({
    //   url: "/do-uploadprofileimage3",
    //   method: "POST",
    //   data: formData,
    //   success: function (response) {
    //     alert(response.message)
    //     imagePath3 = response;
    //   }
    // })
    document.getElementById("myfile" + data.name).value = url
    console.log(document.getElementById("myfile0").value)

  }

  async function uploadImage1() {
    const ref = firebase.storage().ref();
    const file = document.querySelector("#photo1").files[0];
    const name = +new Date() + "-" + file.name;
    const metadata = {
      contentType: file.type
    };
    try {
      await ref.child(name).put(file, metadata).then(snapshot => snapshot.ref.getDownloadURL())
        .then(url => {
          newurl = url
          callback1(url)
        })
    }
    catch (err) {
      console.log(err)
    }

    function callback1(url) {
      console.log(url)
      newcallback1(url)
    }
  }
  var imagePath1 = ""
  function newcallback1(url) {
    let newurl = url;
    // var formData = {
    //   uploadimg: newurl,
    // };
    // $.ajax({
    //   url: "/do-uploadprofileimage3",
    //   method: "POST",
    //   data: formData,
    //   success: function (response) {
    //     alert(response.message)
    //     imagePath1 = response;
    //   }
    // })
    document.getElementById("solutionsimg" + index).innerText = newurl
  }


  async function uploadImage2() {
    const ref = firebase.storage().ref();
    const file = document.querySelector("#photo2").files[0];
    const name = +new Date() + "-" + file.name;
    const metadata = {
      contentType: file.type
    };
    try {
      await ref.child(name).put(file, metadata).then(snapshot => snapshot.ref.getDownloadURL())
        .then(url => {
          newurl = url
          callback2(url)
        })
    }
    catch (err) {
      console.log(err)
    }
    function callback2(url) {
      console.log(url)
      newcallback2(url)
    }
  }
  var imagePath2 = ""
  function newcallback2(url) {
    let newurl = url;
    // var formData = {
    //   uploadimg: newurl,
    // };
    // $.ajax({
    //   url: "/do-uploadprofileimage3",
    //   method: "POST",
    //   data: formData,
    //   success: function (response) {
    //     alert(response.message)
    //     imagePath2 = response;
    //   }
    // })
    document.getElementById("passageimg" + index).innerText = newurl

  }


  async function uploadImage3() {
    const ref = firebase.storage().ref();
    const file = document.querySelector("#photo3").files[0];
    const name = +new Date() + "-" + file.name;
    const metadata = {
      contentType: file.type
    };
    try {
      await ref.child(name).put(file, metadata).then(snapshot => snapshot.ref.getDownloadURL())
        .then(url => {
          newurl = url
          callback3(url)
        })
    }
    catch (err) {
      console.log(err)
    }
    function callback3(url) {
      console.log(url)
      newcallback3(url)
    }
  }
  var imagePath = ""
  function newcallback3(url) {
    let newurl = url;
    // var formData = {
    //   uploadimg: newurl,
    // };
    // $.ajax({
    //   url: "/do-uploadprofileimage3",
    //   method: "POST",
    //   data: formData,
    //   success: function (response) {
    //     alert(response.message)
    //     imagePath = response;
    //   }
    // })
    document.getElementById("queimg" + index).innerText = newurl

  }

  //------------------------------options upload------------------------------------------------
  async function uploadImage5(data) {
    const ref = firebase.storage().ref();
    const file = document.querySelector("#photo5").files[0];
    console.log(file)
    const name = +new Date() + "-" + file.name;
    const metadata = {
      contentType: file.type
    };


    let oldimg = document.getElementById("optionImg1" + data.name).value.split("/o")[1].split("?")[0].split("/")[1]
    console.log(oldimg)
    try {
      ref.child(oldimg).delete()
      console.log("file is deleted")
    }
    catch (err) {
      console.log(err)
    }



    try {
      await ref.child(name).put(file, metadata).then(snapshot => snapshot.ref.getDownloadURL())
        .then(url => {
          newurl = url
          callback5(url,data)
        })
    }
    catch (err) {
      console.log(err)
    }

    function callback5(url,data) {
      console.log(url)
      newcallback5(url,data)
    }
  }
  var imagePath5 = ""
  function newcallback5(url,data) {
    let newurl = url;

    // var formData = {
    //   uploadimg: newurl,
    // };
    // $.ajax({
    //   url: "/do-uploadprofileimage3",
    //   method: "POST",
    //   data: formData,
    //   success: function (response) {
    //     alert(response.message)
    //     imagePath5 = response;
    //   }
    // })
    document.getElementById("optionImg1" + data.name).innerText = url

  }

  async function uploadImage6() {
    const ref = firebase.storage().ref();
    const file = document.querySelector("#photo6").files[0];
    const name = +new Date() + "-" + file.name;
    const metadata = {
      contentType: file.type
    };
    try {
      await ref.child(name).put(file, metadata).then(snapshot => snapshot.ref.getDownloadURL())
        .then(url => {
          newurl = url
          callback6(url)
        })
    }
    catch (err) {
      console.log(err)
    }
    function callback6(url) {
      console.log(url)
      newcallback6(url)
    }
  }
  var imagePath6 = ""
  function newcallback6(url) {
    // let newurl = url;
    // var formData = {
    //   uploadimg: newurl,
    // };
    // $.ajax({
    //   url: "/do-uploadprofileimage3",
    //   method: "POST",
    //   data: formData,
    //   success: function (response) {
    //     alert(response.message)
    //     imagePath6 = response;
    //   }
    // })
    document.getElementById("optionImg2" + index).innerText = url

  }

  async function uploadImage7() {
    const ref = firebase.storage().ref();
    const file = document.querySelector("#photo7").files[0];
    const name = +new Date() + "-" + file.name;
    const metadata = {
      contentType: file.type
    };
    try {
      await ref.child(name).put(file, metadata).then(snapshot => snapshot.ref.getDownloadURL())
        .then(url => {
          newurl = url
          callback7(url)
        })
    }
    catch (err) {
      console.log(err)
    }

    function callback7(url) {
      console.log(url)
      newcallback7(url)
    }
  }
  var imagePath7 = ""
  function newcallback7(url) {
    let newurl = url;
    // var formData = {
    //   uploadimg: newurl,
    // };
    // $.ajax({
    //   url: "/do-uploadprofileimage3",
    //   method: "POST",
    //   data: formData,
    //   success: function (response) {
    //     alert(response.message)
    //     imagePath7 = response;
    //   }
    // })

    document.getElementById("optionImg3" + index).innerText = newurl

  }

  async function uploadImage8() {
    const ref = firebase.storage().ref();
    const file = document.querySelector("#photo8").files[0];
    const name = +new Date() + "-" + file.name;
    const metadata = {
      contentType: file.type
    };
    try {
      await ref.child(name).put(file, metadata).then(snapshot => snapshot.ref.getDownloadURL())
        .then(url => {
          newurl = url
          callback8(url)
        })
    }
    catch (err) {
      console.log(err)
    }

    function callback8(url) {
      console.log(url)
      newcallback8(url)
    }
  }
  var imagePath8 = ""
  function newcallback8(url) {
    let newurl = url;
    // var formData = {
    //   uploadimg: newurl,
    // };
    // $.ajax({
    //   url: "/do-uploadprofileimage3",
    //   method: "POST",
    //   data: formData,
    //   success: function (response) {
    //     alert(response.message)
    //     imagePath8 = response;
    //   }
    // })
    document.getElementById("optionImg4" + index).innerText = newurl

  }

  //-------------------------------------------------------------------------------------------------



</script>

</html>